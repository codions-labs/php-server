server {
    listen   80; ## listen for ipv4; this line is default and implied

    {{if getenv "NGINX_IPV6" | bool -}}
    listen   [::]:80 default ipv6only=on; ## listen for ipv6
    {{- end}}

    {{if getenv "FORCE_HTTPS" | bool -}}

        {{if getenv "REAL_IP_CLOUDFLARE" | bool -}}
        if ($http_x_forwarded_proto = "http") {
        {{- end}}

        return 301 https://$host$request_uri;

        {{if getenv "REAL_IP_CLOUDFLARE" | bool -}}
        }
        {{- end}}

    {{- end}}

    include app.conf;
}
